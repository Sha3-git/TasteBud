<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Allergy Charts — Dark Mode</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg: #212121;
      --panel: #2f2f2f;
      --muted: #bdbdbd;
      --accent: #4cc9f0;
      --accent2: #ffb86b;
      --text: #f1f1f1;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Arial,sans-serif}
    .container{max-width:1200px;margin:28px auto;padding:20px;display:grid;gap:18px;grid-template-columns: repeat(2, 1fr);}
    header{grid-column:1 / -1; display:flex; align-items:center; gap:12px;}
    header h1{margin:0;font-size:20px;color:var(--text)}
    .card{background:var(--panel);border-radius:12px;padding:14px;min-height:220px}
    .card h3{margin:0 0 8px 0;font-size:14px;color:var(--muted)}
    canvas{width:100% !important;height:260px !important;display:block}
    /* Heatmap grid */
    .heatmap{display:grid;grid-template-columns:140px repeat(4, 1fr);gap:6px;align-items:center}
    .heatmap .row{display:contents}
    .cell{padding:8px;border-radius:6px;text-align:center;font-size:13px;color:var(--text);background:transparent}
    .ingredient-name{font-weight:600;text-align:left;padding-left:10px;color:var(--muted)}
    .legend{display:flex;gap:8px;align-items:center;margin-top:8px}
    .legend .swatch{width:36px;height:12px;border-radius:6px}
    .full-width{grid-column:1 / -1}
    /* Responsive */
    @media (max-width:980px){
      .container{grid-template-columns:1fr}
      canvas{height:320px !important}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Allergy Analysis — Dark Mode</h1>
      <div style="margin-left:auto;color:var(--muted);font-size:13px">Background: #333333</div>
    </header>

    <!-- Weekly Symptom Line -->
    <div class="card">
      <h3>Weekly Symptom Tracker (Severity 0–10)</h3>
      <canvas id="weeklyLine"></canvas>
    </div>

    <!-- Monthly Combo -->
    <div class="card">
      <h3>Monthly Allergen Exposures (bars) vs Symptom Count (line)</h3>
      <canvas id="monthlyCombo"></canvas>
    </div>

    <!-- Heatmap -->
    <div class="card full-width">
      <h3>Ingredient Correlation Heatmap (to symptom types)</h3>
      <div style="color:var(--muted);font-size:13px;margin-bottom:8px">Intensity = correlation strength (0 = low, 1 = high)</div>
      <div id="heatmap" class="heatmap" aria-hidden="false"></div>
      <div class="legend" style="color:var(--muted)">
        <div style="width:10px"></div>
        <div style="font-size:13px">Low</div>
        <div class="swatch" id="legendLow"></div>
        <div style="font-size:13px">High</div>
        <div class="swatch" id="legendHigh"></div>
      </div>
    </div>

    <!-- Yearly Stacked Bar -->
    <div class="card">
      <h3>Yearly Symptom Frequency by Month (stacked)</h3>
      <canvas id="yearlyStacked"></canvas>
    </div>

    <!-- Timeline Scatter -->
    <div class="card">
      <h3>Timeline Scatter — Symptom Events (color = allergen)</h3>
      <canvas id="timelineScatter"></canvas>
    </div>
  </div>

  <script>
    /* ---------- Shared chart defaults (dark theme) ---------- */
    const darkOptions = {
      scales: {
        x: {
          ticks: { color: '#d9d9d9' },
          grid: { color: 'rgba(255,255,255,0.04)' }
        },
        y: {
          ticks: { color: '#d9d9d9' },
          grid: { color: 'rgba(255,255,255,0.04)' }
        }
      },
      plugins: {
        legend: { labels: { color: '#d9d9d9' } },
        tooltip: {
          padding: 8,
          titleColor: '#000',
          bodyColor: '#000',
          backgroundColor: '#fff',
          cornerRadius: 6
        }
      },
      maintainAspectRatio: false
    };

    /* ---------- 1) Weekly Line Chart ---------- */
    (function(){
      const ctx = document.getElementById('weeklyLine').getContext('2d');
      const labels = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
      const data = {
        labels,
        datasets: [
          { label:'Rash', data:[3,4,2,5,6,4,2], borderWidth:2, tension:0.25, borderColor:'#ff6b6b', pointBackgroundColor:'#ff6b6b', fill:false },
          { label:'Congestion', data:[5,6,4,7,6,3,2], borderWidth:2, tension:0.25, borderColor:'#4cc9f0', pointBackgroundColor:'#4cc9f0', fill:false }
        ]
      };
      new Chart(ctx, {
        type:'line',
        data,
        options: {
          ...darkOptions,
          plugins: { ...darkOptions.plugins, tooltip: {...darkOptions.plugins.tooltip, titleColor:'#fff', bodyColor:'#fff', backgroundColor:'#222' } },
          scales: {
            x: darkOptions.scales.x,
            y: { ...darkOptions.scales.y, suggestedMin:0, suggestedMax:10 }
          }
        }
      });
    })();

    /* ---------- 2) Monthly Combo (Bar + Line) ---------- */
    (function(){
      const ctx = document.getElementById('monthlyCombo').getContext('2d');
      const labels = ['Dairy','Nuts','Soy','Wheat','Fish'];
      const data = {
        labels,
        datasets:[
          { type:'bar', label:'Exposures', data:[8,5,3,7,2], backgroundColor:'#7c5cff88', borderRadius:6 },
          { type:'line', label:'Symptom events', data:[5,6,2,4,1], borderColor:'#ffb86b', borderWidth:2, tension:0.3, pointBackgroundColor:'#ffb86b' }
        ]
      };
      new Chart(ctx, {
        type:'bar',
        data,
        options: {
          ...darkOptions,
          plugins: { ...darkOptions.plugins, tooltip: {...darkOptions.plugins.tooltip, backgroundColor:'#222', bodyColor:'#fff'} },
          scales: {
            x: darkOptions.scales.x,
            y: { ...darkOptions.scales.y, beginAtZero:true }
          }
        }
      });
    })();

    /* ---------- 3) Ingredient Heatmap (HTML grid + JS color scale) ---------- */
    (function(){
      // sample ingredient correlation (0..1)
      const ingredients = [
        { name: 'Milk', Rash: 0.8, Congestion: 0.3, Fatigue: 0.2, Swelling: 0.5 },
        { name: 'Wheat', Rash: 0.9, Congestion: 0.4, Fatigue: 0.6, Swelling: 0.2 },
        { name: 'Soy', Rash: 0.4, Congestion: 0.2, Fatigue: 0.1, Swelling: 0.1 },
        { name: 'Almond', Rash: 0.6, Congestion: 0.2, Fatigue: 0.1, Swelling: 0.4 },
        { name: 'Egg', Rash: 0.3, Congestion: 0.1, Fatigue: 0.05, Swelling: 0.1 }
      ];
      const types = ['Rash','Congestion','Fatigue','Swelling'];
      const container = document.getElementById('heatmap');

      // header row
      const headerLabel = document.createElement('div'); headerLabel.className='cell';
      headerLabel.innerHTML = '<div style="font-weight:700;color:var(--muted)">Ingredient</div>';
      container.appendChild(headerLabel);
      types.forEach(t=>{
        const h = document.createElement('div'); h.className='cell'; h.style.color='var(--muted)'; h.style.fontSize='13px'; h.innerText = t;
        container.appendChild(h);
      });

      // color scale helper: map [0..1] -> color from cool -> warm
      function colorFor(v){
        // interpolate between two colors (cool -> warm)
        const low = [45,45,45]; // dark gray
        const high = [255,107,107]; // warm red
        const r = Math.round(low[0] + (high[0]-low[0]) * v);
        const g = Math.round(low[1] + (high[1]-low[1]) * v);
        const b = Math.round(low[2] + (high[2]-low[2]) * v);
        const alpha = 0.95;
        return `rgba(${r},${g},${b},${alpha})`;
      }

      // build rows
      ingredients.forEach(row=>{
        // ingredient name cell
        const nameCell = document.createElement('div'); nameCell.className='cell ingredient-name'; nameCell.innerText = row.name;
        container.appendChild(nameCell);
        // data cells
        types.forEach(t=>{
          const v = Math.max(0, Math.min(1, row[t] ?? 0));
          const c = document.createElement('div'); c.className='cell';
          c.innerText = (v*100).toFixed(0) + '%';
          c.title = `${row.name} → ${t}: ${v}`;
          c.style.background = colorFor(v);
          c.style.boxShadow = 'inset 0 0 0 1px rgba(255,255,255,0.03)';
          container.appendChild(c);
        });
      });

      // legend swatches
      document.getElementById('legendLow').style.background = colorFor(0.05);
      document.getElementById('legendHigh').style.background = colorFor(1.0);
    })();

    /* ---------- 4) Yearly stacked bar ---------- */
    (function(){
      const ctx = document.getElementById('yearlyStacked').getContext('2d');
      const labels = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      const congestion = [12,10,14,20,25,18,22,17,15,12,11,9];
      const rash =       [8,6,9,12,13,11,10,9,8,6,7,5];
      const stomach =    [5,4,6,8,10,7,9,6,4,3,2,2];
      const swelling =   [2,3,2,4,5,3,4,2,1,1,1,1];
      new Chart(ctx, {
        type:'bar',
        data: {
          labels,
          datasets: [
            { label:'Congestion', data:congestion, stack:'a', backgroundColor:'#4cc9f0' },
            { label:'Rash', data:rash, stack:'a', backgroundColor:'#ff6b6b' },
            { label:'Stomach', data:stomach, stack:'a', backgroundColor:'#ffd166' },
            { label:'Swelling', data:swelling, stack:'a', backgroundColor:'#9be7a6' }
          ]
        },
        options: {
          ...darkOptions,
          plugins: { ...darkOptions.plugins, tooltip: {...darkOptions.plugins.tooltip, backgroundColor:'#222', bodyColor:'#fff'} },
          scales: {
            x: darkOptions.scales.x,
            y: { ...darkOptions.scales.y, beginAtZero:true }
          }
        }
      });
    })();

    /* ---------- 5) Timeline Scatter ---------- */
    (function(){
      // We'll map dates to numeric x values for charting (1..30)
      const ctx = document.getElementById('timelineScatter').getContext('2d');
      const events = [
        // {day (1..30), severity(0..10), allergen}
        {d:1, s:2, a:'Egg'}, {d:3, s:6, a:'Milk'}, {d:5, s:8, a:'Peanut'},
        {d:9, s:4, a:'Wheat'}, {d:12, s:7, a:'Soy'}, {d:14, s:5, a:'Dairy'},
        {d:18, s:9, a:'Peanut'}, {d:21, s:3, a:'Egg'}, {d:25, s:6, a:'Wheat'},
        {d:28, s:4, a:'Fish'}
      ];
      // group by allergen for colored scatter sets
      const colors = {
        'Peanut':'#ff6b6b',
        'Milk':'#ffd166',
        'Wheat':'#7c5cff',
        'Soy':'#4cc9f0',
        'Dairy':'#9be7a6',
        'Egg':'#f08cff',
        'Fish':'#8fd3ff'
      };
      const allergens = [...new Set(events.map(e=>e.a))];
      const datasets = allergens.map(a=>{
        const data = events.filter(e=>e.a===a).map(ev=>({x:ev.d, y:ev.s, r: 6}));
        return { label:a, data, showLine:false, backgroundColor:colors[a]||'#ddd' };
      });

      new Chart(ctx, {
        type:'bubble',
        data:{ datasets },
        options: {
          ...darkOptions,
          plugins: { ...darkOptions.plugins, tooltip: {...darkOptions.plugins.tooltip, backgroundColor:'#222', bodyColor:'#fff'} },
          scales: {
            x: { ...darkOptions.scales.x, title: { display:true, text:'Day of month', color:'#d9d9d9' }, min:0, max:31, ticks:{stepSize:2} },
            y: { ...darkOptions.scales.y, title: { display:true, text:'Severity (0-10)', color:'#d9d9d9' }, min:0, max:10 }
          }
        }
      });
    })();

  </script>
</body>
</html>
